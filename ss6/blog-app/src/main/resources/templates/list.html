<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách bài viết</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #f0f4f8, #d9e4ec);
            padding: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #1e3d59;
        }
        .container {
            width: 90%;
            max-width: 1100px;
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        form input, form textarea, form select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        form button {
            align-self: flex-start;
            padding: 10px 18px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        form button:hover { background: #0056b3; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        thead { background: #1e3d59; color: #fff; }
        th, td { padding: 10px; text-align: center; }
        tbody tr:nth-child(even) { background: #f8f9fa; }
        .actions a { margin: 0 5px; text-decoration: none; }
    </style>
</head>
<body>

<h1>Danh sách bài viết</h1>

<div class="container">

    <!-- Form thêm blog -->
    <form id="blog-form">
        <label>Tiêu đề:</label>
        <input type="text" id="title" required/>

        <label>Nội dung:</label>
        <textarea id="content" required></textarea>

        <label>Tác giả:</label>
        <input type="text" id="author" required/>

        <label>Trạng thái:</label>
        <select id="status">
            <option value="PUBLISHED">Đã xuất bản</option>
            <option value="DRAFT">Bản nháp</option>
        </select>

        <label>Danh mục:</label>
        <select id="categoryId">
            <option value="" disabled selected>-- Chọn danh mục --</option>
            <option th:each="cat : ${categories}"
                    th:value="${cat.idCag}"
                    th:text="${cat.nameCag}">
            </option>
        </select>

        <button type="submit">Đăng bài</button>
    </form>

    <!-- Danh sách bài viết -->
    <table>
        <thead>
        <tr>
            <th>Tiêu đề</th>
            <th>Ngày đăng</th>
            <th>Danh mục</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody id="blog-list">
        <!-- AJAX sẽ load dữ liệu vào đây -->
        </tbody>
    </table>

</div>

<script>
    $(document).ready(function () {
        // Load danh sách blog
        function loadBlogs() {
            $.ajax({
                url: "/api/blogs",
                method: "GET",
                success: function (data) {
                    let rows = "";
                    if (data.length === 0) {
                        rows = "<tr><td colspan='4'>Chưa có bài viết nào.</td></tr>";
                    } else {
                        data.forEach(function (blog) {
                            rows += `
                                <tr>
                                    <td>${blog.title}</td>
                                    <td>${blog.date ? blog.date : ""}</td>
                                    <td>${blog.category ? blog.category.nameCag : "Không có"}</td>
                                    <td class="actions">
                                        <a href="/blogs/${blog.id}" class="view">Xem</a>
                                        <a href="/blogs/edit/${blog.id}" class="edit">Sửa</a>
                                        <a href="/blogs/delete/${blog.id}" class="delete">Xoá</a>
                                    </td>
                                </tr>`;
                        });
                    }
                    $("#blog-list").html(rows);
                },
                error: function () {
                    alert("Không thể tải danh sách blog");
                }
            });
        }

        // Gọi load khi trang mở
        loadBlogs();

        // Submit form AJAX
        $("#blog-form").submit(function (e) {
            e.preventDefault();

            let blogData = {
                title: $("#title").val(),
                content: $("#content").val(),
                author: $("#author").val(),
                date: new Date().toISOString().split("T")[0], // yyyy-MM-dd
                status: $("#status").val(),
                categoryId: $("#categoryId").val()
            };

            $.ajax({
                url: "/api/blogs",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(blogData),
                success: function () {
                    alert("Đăng bài thành công!");
                    $("#blog-form")[0].reset();
                    loadBlogs();
                },
                error: function (xhr) {
                    alert("Lỗi khi đăng bài: " + xhr.responseText);
                }
            });
        });
    });
</script>

</body>
</html>
